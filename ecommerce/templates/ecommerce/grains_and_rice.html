{% extends 'ecommerce/base.html' %}
{% load static %}
{% load custom_tags %}

{% block body %}
<body class="bg-dark">
    <div class="d-flex ms-5">
        {% for item in breadcrumb %}
            {% if forloop.last %}
                <h6 class="mt-4"><a href="{{ item.1 }}" class="text-decoration-none text-white">{{ item.0 }}</a></h6>
            {% else %}
                <h6 class="mt-4"><a href="{{ item.1 }}" class="text-decoration-none text-white">{{ item.0 }} ></a></h6>
            {% endif %}
        {% endfor %}
    </div>
    

    {% include 'ecommerce/ad.html' %}

    <div class="row mt-4">
        <!-- First Card -->
        <div class="col-md-2 mb-4 ">
            <div class="black-card my-account-card ms-5">
                <ul class="custom-list">
                    <div style="display: flex; justify-content: space-between;">
                        <div><b>PRICE (â‚¦)</b></div>
                        <div><a href="" class="text-decoration-none text-primary" id="applyFilterBtn">APPLY</a></div>
                    </div>
                    <div id="priceSlider"></div>
                    <div class="mt-3" style="display: flex; align-items: center; justify-content: space-between;">
                        <input type="number" id="minPriceInput" class="priceInput" value="{{ min_price }}">
                        <div>-</div>
                        <input type="number" id="maxPriceInput" class="priceInput" value="{{ max_price }}">
                    </div>
                    <hr>
                    

                    <div><b>PRODUCT RATING</b></div>
                    <label class="container mt-2">
                        <input type="radio" name="discount" class="circle" value="4">
                        <span class="checkmark"></span>
                        <div class="static-stars ms-2">
                            <span class="star">&#9733;</span>
                            <span class="star">&#9733;</span>
                            <span class="star">&#9733;</span>
                            <span class="star">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="text-white">& above</span>
                        </div>
                    </label>

                    <label class="container">
                        <input type="radio" name="discount" class="circle" value="4">
                        <span class="checkmark"></span>
                        <div class="static-stars ms-2">
                            <span class="star">&#9733;</span>
                            <span class="star">&#9733;</span>
                            <span class="star">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="text-white">& above</span>
                        </div>
                    </label>

                    <label class="container">
                        <input type="radio" name="discount" class="circle" value="4">
                        <span class="checkmark"></span>
                        <div class="static-stars ms-2">
                            <span class="star">&#9733;</span>
                            <span class="star">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="text-white">& above</span>
                        </div>
                    </label>

                    <label class="container">
                        <input type="radio" name="discount" class="circle" value="4">
                        <span class="checkmark"></span>
                        <div class="static-stars ms-2">
                            <span class="star">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="star star-none">&#9733;</span>
                            <span class="text-white">& above</span>
                        </div>
                    </label>
                    
                </ul>
            </div>
        </div>

       <div class="col-md-8 ms-auto black-card" style="margin-right: 50px; height: auto;">
        <div class="d-flex" style="justify-content: space-between;">
            <h5>Rice & Grains</h5>
            <div>
                <i id="stackIcon" class="bi bi-view-stacked" onclick="toggleView('stacked')"></i>
                <i id="gridIcon" class="bi bi-grid-fill ms-2" onclick="toggleView('grid')"></i>
            </div>
           
        </div>
           
           <hr>

           <div class="row" id="productItemsContainer">
                {% for product in products %}
                <div class="col-lg-3 col-md-4 grid-view">
                    <div class="position-relative product-card" data-product-id="{{ product.id }}">
                        <a href="{% url 'ecommerce:product_detail' product_id=product.id %}">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="top-selling-image img-fluid">
                            
                            <div class="item-name">&nbsp;&nbsp;{{ product.name }}</div>
                            <div class="item-price text-white">&nbsp;&nbsp;N&nbsp;{{ product.formatted_price }}</div>
                            {% if product.old_price > 0 and product.old_price > product.new_price %}
                            <div class="d-flex">
                                <div class="slashed-price text-white ms-2" style="text-decoration: line-through; font-size: 13px;">N&nbsp;{{ product.formatted_old_price }}</div>
                                <span class="badge bg-danger ms-2">{{ product.discount_percentage }}%</span>
                            </div>
                            {% endif %}
                            <div class="rating">
                                <div class="static-stars ms-2">
                                    <span class="star">&#9733;</span>
                                    <span class="star">&#9733;</span>
                                    <span class="star">&#9733;</span>
                                    <span class="star">&#9733;</span>
                                    <span class="star">&#9733;</span>
                                    <span class="text-white">(12)</span>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <button class="btn btn-primary mt-2 mb-2 add-to-cart-btn" data-product-id="{{ product.id }}"  data-add-to-cart-url="{% url 'ecommerce:add_to_cart' %}" style="width: 90%;">Add To Cart</button>

                                <div class="d-flex justify-content-between align-items-center" style="display: none !important;">
                                            
                                    <button id="remove-product" class="btn btn-primary mb-2 remove-product-btn me-5" data-product-id="{{ product.id }}" data-remove-from-cart-url="{% url 'ecommerce:remove_from_cart' %}">
                                        <i class="bi bi-dash-lg"></i>
                                    </button>

                                    <span class="product-count text-white" data-product-id="{{ product.id }}">{{ product.cart_quantity|default:0 }}</span>

                                    <button id="add-product" class="btn btn-primary mb-2 add-product ms-5" data-product-id="{{ product.id }}">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </a>
                    </div>
                    
                </div>
                {% endfor %} 
                
                {% for product in products %}
                <div class="col-lg-12 col-md-4 stacked-view" style="display: none;">
                        <div class="position-relative product-card" data-product-id="{{ product.id }}">
                            <!-- First column for product image -->
                            <div class="row"> 
                                <div class="col-4">
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="top-selling-image img-fluid">
                                </div>
                
                                <div class="col-4">
                                    <div class="item-name">&nbsp;&nbsp;{{ product.name }}</div>
                                    <div class="rating">
                                        <div class="static-stars ms-2">
                                            <span class="star">&#9733;</span>
                                            <span class="star">&#9733;</span>
                                            <span class="star">&#9733;</span>
                                            <span class="star">&#9733;</span>
                                            <span class="star">&#9733;</span>
                                            <span class="text-white">(12)</span>
                                        </div>
                                    </div>
                                </div>
                
                                <div class="col-4 d-flex flex-column justify-content-between">
                                    <div class="ms-auto">
                                        <div class="item-price text-white">&nbsp;&nbsp;N&nbsp;{{ product.formatted_price }}</div>
                                        {% if product.old_price > 0 and product.old_price > product.new_price %}
                                            <div class= "d-flex">
                                                <div class="slashed-price text-white ms-2" style="text-decoration: line-through; font-size: 13px;">N&nbsp;{{ product.formatted_old_price }}</div>
                                                <span class="badge bg-danger ms-2">{{ product.discount_percentage }}%</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <button class="btn btn-primary mt-2 mb-2 add-to-cart-btn" data-product-id="{{ product.id }}"  data-add-to-cart-url="{% url 'ecommerce:add_to_cart' %}" style="width: 90%;">Add To Cart</button>
                                        <div class="d-flex justify-content-between" style="display: none !important">
                                            
                                            <button id="remove-product" class="btn btn-primary ms-5 mb-2 remove-product-btn" data-product-id="{{ product.id }}" data-remove-from-cart-url="{% url 'ecommerce:remove_from_cart' %}">
                                                <i class="bi bi-dash-lg"></i>
                                            </button>

                                            
                                            <span class="product-count" data-product-id="{{ product.id }}">{{ product.cart_quantity|default:0 }}</span>


                                            <button id="add-product" class="btn btn-primary me-3 mb-2 add-product" data-product-id="{{ product.id }}">
                                                <i class="bi bi-plus-lg"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                </div>
                
                {% endfor %} 
        
                <div id="cartCountUrl" data-url="{% url 'ecommerce:cart_count' %}"></div>
            </div>
        </div>
           
    </div>
   
    <div class="black-card-beneath">
        <!-- Add your content for the black card here -->
            <h5 class="top-selling-title">Recently Viewed</h5>
        <!-- Render the recently viewed products section -->
        {% render_recently_viewed_products request.user %}
    
    </div>

    
</body>
{% endblock %}